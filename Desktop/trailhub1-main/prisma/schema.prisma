enum DifficultyLevel {
  EASY
  MODERATE
  HARD
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(uuid())
  firebaseUid  String?       @unique
  email        String        @unique
  name         String?
  role         String
  createdAt    DateTime      @default(now())
  bookings     Booking[]
  guide        Guide?
  hikerProfile HikerProfile?
  reviews      Review[]
}

model Guide {
  id              String    @id @default(uuid())
  userId          String    @unique
  bio             String?
  location        String?
  photoUrl        String?
  displayName     String?
  languages       String[] // Array of languages spoken
  yearsExperience Int?
  isVerified      Boolean   @default(false)
  verifiedAt      DateTime?
  verifiedBy      String?
  profileSlug     String?
  isFeatured      Boolean   @default(false)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  user            User      @relation(fields: [userId], references: [id])
  hikes           Hike[]
  reviews         Review[]
}

model HikerProfile {
  id                  String   @id @default(uuid())
  userId              String   @unique
  bio                 String?
  location            String?
  photoUrl            String?
  displayName         String?
  fitnessLevel        String? // e.g., "beginner", "intermediate", "advanced"
  preferredDifficulty String[] // Array of preferred difficulty levels
  interests           String[] // Array of hiking interests
  emergencyContact    String?
  medicalInfo         String? // Medical conditions/allergies
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id])
}

model Hike {
  id          String    @id @default(uuid())
  title       String
  description String?
  difficulty  DifficultyLevel   // "easy", "moderate", "hard"
  distance    String?   // e.g., "8.5 km"
  duration    String?   // e.g., "4-5 hours"
  price       Int?
  capacity    Int?
  location    String?
  date        DateTime?
  meetingTime String?  // e.g., "08:30" local meeting time
  coverUrl    String?   // URL to cover image or storage key
  gpxPath     String?   // path/key for uploaded GPX route
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  guideId     String    // required: hike must be created by a guide
  bookings    Booking[]
  guide       Guide     @relation(fields: [guideId], references: [id], onDelete: Cascade)
}

model Booking {
  id        String   @id @default(uuid())
  userId    String
  hikeId    String
  status    String
  createdAt DateTime @default(now())
  hike      Hike     @relation(fields: [hikeId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])
}

model Review {
  id        String   @id @default(uuid())
  userId    String
  guideId   String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  guide     Guide    @relation(fields: [guideId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}